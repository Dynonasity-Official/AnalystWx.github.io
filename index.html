<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>AnalystWx – Radar Viewer</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; font-family: 'Inter', sans-serif; }
        #map { position: absolute; top:0; left:0; width:100vw; height:100vh; }

        /* UI Panels */
        .namePanel, .panel {
            position: fixed; background: linear-gradient(to bottom, #1E90FF, #ADD8E6);
            padding: 10px; border-radius: 10px; box-shadow: 0 3px 6px rgba(0,0,0,0.3); z-index:1000;
        }
        .namePanel { top:8px; left:8px; }
        .panel { bottom:8px; left:50%; transform: translateX(-50%); }

        .blue-button {
            background:#1E90FF; color:white; border:none; padding:8px 16px;
            border-radius:8px; font-weight:bold; cursor:pointer; margin-right:6px;
        }
        .blue-button.active { background:#0066cc; }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="namePanel"><strong>AnalystWx</strong></div>

    <div class="panel">
        <button id="nexradBtn" class="blue-button">NEXRAD Composite</button>
        <button id="rainviewerBtn" class="blue-button">RainViewer Radar</button>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- INITIAL MAP SETUP ---
        const map = L.map('map').setView([37.8, -96], 4);

        // Satellite + Boundaries
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')
            .addTo(map);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png').addTo(map);

        // Helper for toggling one active overlay
        let currentOverlay = null;
        function setOverlay(layer, btn) {
            if (currentOverlay) {
                map.removeLayer(currentOverlay.layer);
                currentOverlay.btn.classList.remove('active');
            }
            currentOverlay = { layer, btn };
            map.addLayer(layer);
            btn.classList.add('active');
        }

        // --- RADAR TILE LAYERS ---

        // 1) Mesonet NEXRAD Composite (your original)
        const nexradLayer = L.tileLayer(
            "https://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/{z}/{x}/{y}.png"
        );

        // 2) RainViewer public radar tiles (with time parameter)
        let rainviewerLayer = null;
        function loadRainViewer() {
            // pick a timestamp — we'll use the latest from RainViewer
            fetch("https://api.rainviewer.com/public/weather-maps.json")
                .then(r => r.json())
                .then(json => {
                    // pick latest frame
                    const ts = json.radar && json.radar.length && json.radar.slice(-1)[0];
                    if (!ts) return alert("No RainViewer radar timestamps found");

                    const urlTemplate = `https://tilecache.rainviewer.com/v2/radar/${ts}/{z}/{x}/{y}/2/1_1.png`;
                    rainviewerLayer = L.tileLayer(urlTemplate, { opacity: 0.7 });
                    setOverlay(rainviewerLayer, document.getElementById("rainviewerBtn"));
                }).catch(err => {
                    console.error(err);
                    alert("Failed to load RainViewer radar");
                });
        }

        // Button events
        document.getElementById("nexradBtn").onclick = () => setOverlay(nexradLayer, document.getElementById("nexradBtn"));
        document.getElementById("rainviewerBtn").onclick = loadRainViewer;

    </script>
</body>
</html>
